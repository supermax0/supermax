<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تفاصيل المنتج</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="تفاصيل شاشة ذكية مع المواصفات والسعر">

<style>
/* ===== RESET ===== */
*{box-sizing:border-box;margin:0;padding:0}
body{
 font-family:Tajawal,system-ui;
 background:#050b14;
 color:#fff;
 min-height:100vh;
}

/* ===== VARS ===== */
:root{
 --glass:rgba(255,255,255,.14);
 --blur:blur(22px);
 --green:#00ff88;
 --blue:#00ccff;
 --red:#ff4d4d;
 --radius:24px;
}

/* ===== BG ===== */
body::before{
 content:"";
 position:fixed;
 inset:-20%;
 background:
 radial-gradient(circle at 20% 20%,#00ff8860,transparent 40%),
 radial-gradient(circle at 80% 30%,#00ccff60,transparent 40%),
 radial-gradient(circle at 50% 80%,#ff00cc40,transparent 40%);
 filter:blur(120px);
 z-index:-1;
}

/* ===== CONTAINER ===== */
.container{
 max-width:1200px;
 margin:40px auto;
 padding:30px;
 background:var(--glass);
 backdrop-filter:var(--blur);
 border-radius:var(--radius);
}

/* ===== BREADCRUMB ===== */
.breadcrumb{
 font-size:14px;
 opacity:.8;
 margin-bottom:20px;
}
.breadcrumb a{
 color:var(--blue);
 text-decoration:none;
}

/* ===== LAYOUT ===== */
.product{
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:30px;
}

/* ===== GALLERY ===== */
.main-img{
 width:100%;
 height:360px;
 object-fit:contain;
 border-radius:20px;
 background:rgba(255,255,255,.08);
 padding:20px;
 transition:.4s;
}
.main-img:hover{
 transform:scale(1.03);
}
.thumbs{
 display:flex;
 gap:10px;
 margin-top:12px;
}
.thumbs img{
 width:70px;
 height:70px;
 object-fit:contain;
 border-radius:14px;
 background:rgba(255,255,255,.08);
 padding:8px;
 cursor:pointer;
 opacity:.7;
 transition:.3s;
}
.thumbs img.active,
.thumbs img:hover{
 opacity:1;
 outline:2px solid var(--green);
}

/* ===== INFO ===== */
h1{margin-bottom:10px}
.specs{
 opacity:.85;
 margin-bottom:15px;
}
.price{
 font-size:28px;
 font-weight:900;
 color:var(--green);
 margin:10px 0;
}
.stock{
 font-size:15px;
 margin-bottom:15px;
}
.stock.out{
 color:var(--red);
 font-weight:700;
}

/* ===== ACTIONS ===== */
.actions{
 display:flex;
 gap:10px;
 flex-wrap:wrap;
}
button{
 border:none;
 border-radius:30px;
 padding:12px 30px;
 font-weight:900;
 cursor:pointer;
}
.buy{
 background:linear-gradient(135deg,var(--green),var(--blue));
 color:#000;
}
.buy:disabled{
 background:#555;
 color:#999;
 cursor:not-allowed;
}
.wa{
 background:rgba(255,255,255,.15);
 color:#fff;
}

/* ===== RESPONSIVE ===== */
@media(max-width:900px){
 .product{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="container">
 <div class="breadcrumb">
  <a href="index.html">الرئيسية</a> › <span id="bc">المنتج</span>
 </div>

 <div class="product" id="product">
  <p>جاري تحميل المنتج...</p>
 </div>
</div>

<script type="module">
import { db } from "./firebase.js";
import { doc, getDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const id = new URLSearchParams(location.search).get("id");
const box = document.getElementById("product");
const bc = document.getElementById("bc");

if(!id){
 box.innerHTML="<p>❌ لم يتم تحديد المنتج</p>";
 throw "No ID";
}

const snap = await getDoc(doc(db,"products",id));

if(!snap.exists()){
 box.innerHTML="<p>❌ المنتج غير موجود</p>";
}else{
 const p = snap.data();
 bc.textContent = p.name;

 const images = (p.images && p.images.length)
  ? p.images
  : [p.image];

 box.innerHTML = `
  <div>
   <img src="${images[0]}" class="main-img" id="mainImg">
   <div class="thumbs">
    ${images.map((img,i)=>`
     <img src="${img}" ${i===0?'class="active"':''}
      onclick="changeImg('${img}',this)">
    `).join("")}
   </div>
  </div>

  <div>
   <h1>${p.name}</h1>
   <div class="specs">${p.specs || ""}</div>

   <div class="price">${Number(p.price).toLocaleString()} د.ع</div>

   <div class="stock ${p.stock<=0?'out':''}">
    ${p.stock<=0?'❌ نفد المخزون':'متوفر: '+p.stock}
   </div>

   <div class="actions">
    <button class="buy" ${p.stock<=0?'disabled':''} onclick="buyNow()">شراء الآن</button>
    <button class="wa" onclick="shareWA()">مشاركة واتساب</button>
   </div>
  </div>
 `;

 window.changeImg = (src,el)=>{
  document.getElementById("mainImg").src = src;
  document.querySelectorAll(".thumbs img").forEach(i=>i.classList.remove("active"));
  el.classList.add("active");
 };

 window.buyNow = ()=>{
  localStorage.setItem("cart",JSON.stringify([{id,...p}]));
  location.href="checkout.html";
 };

 window.shareWA = ()=>{
  const msg = `
${p.name}
السعر: ${Number(p.price).toLocaleString()} د.ع
رابط المنتج:
${location.href}
`;
  window.open("https://wa.me/?text="+encodeURIComponent(msg));
 };
}
</script>

</body>
</html>
