<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Admin | Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
 font-family:Tajawal,system-ui;
 background:#050b14;
 color:#fff;
 min-height:100vh;
}

/* VARS */
:root{
 --glass:rgba(255,255,255,.14);
 --blur:blur(22px);
 --green:#00ff88;
 --blue:#00ccff;
 --red:#ff4d4d;
 --yellow:#ffaa00;
 --radius:22px;
}

/* BG */
body::before{
 content:"";
 position:fixed;
 inset:-20%;
 background:
 radial-gradient(circle at 20% 20%,#00ff8860,transparent 40%),
 radial-gradient(circle at 80% 30%,#00ccff60,transparent 40%),
 radial-gradient(circle at 50% 80%,#ff00cc40,transparent 40%);
 filter:blur(120px);
 z-index:-1;
}

/* NAV */
.nav{
 display:flex;
 justify-content:center;
 gap:15px;
 padding:15px;
 margin:20px;
 background:rgba(255,255,255,.08);
 backdrop-filter:var(--blur);
 border-radius:18px;
}
.nav a{
 padding:10px 24px;
 border-radius:30px;
 text-decoration:none;
 font-weight:800;
 background:rgba(255,255,255,.12);
 color:#fff;
}
.nav a.active{
 background:linear-gradient(135deg,var(--green),var(--blue));
 color:#000;
}

/* CONTAINER */
.container{
 max-width:1200px;
 margin:20px auto;
 padding:30px;
 background:var(--glass);
 backdrop-filter:var(--blur);
 border-radius:var(--radius);
}

h2{
 text-align:center;
 margin-bottom:25px;
}

/* ORDER CARD */
.order{
 background:rgba(255,255,255,.1);
 border-radius:18px;
 padding:16px;
 margin-bottom:16px;
}
.order strong{font-size:16px}
.order small{opacity:.75}

/* STATUS */
.status{
 font-weight:900;
}
.new{color:var(--blue)}
.done{color:var(--green)}
.cancel{color:var(--yellow)}

/* ACTIONS */
.actions{
 display:flex;
 flex-wrap:wrap;
 gap:8px;
 margin-top:12px;
}
button{
 border:none;
 border-radius:30px;
 padding:8px 18px;
 font-weight:800;
 cursor:pointer;
}
.btn-new{background:var(--blue);color:#000}
.btn-done{background:var(--green);color:#000}
.btn-cancel{background:var(--yellow);color:#000}
.btn-del{background:var(--red);color:#fff}
.btn-wa{
 background:rgba(255,255,255,.15);
 color:#fff;
}
</style>
</head>

<body>

<!-- NAV -->
<div class="nav">
 <a href="admin.html">ğŸ› ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
 <a href="admin-orders.html" class="active">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
</div>

<div class="container">
 <h2>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
 <div id="orders">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</div>
</div>

<script type="module">
import { db } from "./firebase.js";
import {
 collection, getDocs,
 doc, updateDoc, deleteDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const box = document.getElementById("orders");

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
async function loadOrders(){
 box.innerHTML = "";
 const snap = await getDocs(collection(db,"orders"));

 if(snap.empty){
  box.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>";
 }

 snap.forEach(d=>{
  const o = d.data();

  let cls = "new";
  if(o.status === "ØªÙ…") cls = "done";
  if(o.status === "Ù…Ù„ØºÙŠ") cls = "cancel";

  const waMsg = `
Ø·Ù„Ø¨ Ø±Ù‚Ù…: ${d.id}

ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${o.name}
ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${o.phone}
ğŸ“ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${o.city}
ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${o.address}

ğŸ–¥ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:
${o.cart.map(p=>"- "+p.name).join("\n")}

ğŸ’° Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${Number(o.total).toLocaleString()} Ø¯.Ø¹
`;

  box.innerHTML += `
   <div class="order">
    <strong>ğŸ‘¤ ${o.name}</strong> â€“ ${o.phone}<br>
    <small>${o.city} - ${o.address}</small><br><br>

    ğŸ–¥ï¸ <strong>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</strong><br>
    ${o.cart.map(p=>`â€¢ ${p.name}`).join("<br>")}<br><br>

    ğŸ’° <strong>${Number(o.total).toLocaleString()} Ø¯.Ø¹</strong><br>
    ğŸ“… ${o.createdAt || ""}<br><br>

    Ø§Ù„Ø­Ø§Ù„Ø©:
    <span class="status ${cls}">${o.status}</span>

    <div class="actions">
     <button class="btn-new" onclick="setStatus('${d.id}','Ø¬Ø¯ÙŠØ¯')">Ø¬Ø¯ÙŠØ¯</button>
     <button class="btn-done" onclick="setStatus('${d.id}','ØªÙ…')">ØªÙ…</button>
     <button class="btn-cancel" onclick="setStatus('${d.id}','Ù…Ù„ØºÙŠ')">Ù…Ù„ØºÙŠ</button>
     <button class="btn-wa" onclick="openWA(\`${encodeURIComponent(waMsg)}\`)">ÙˆØ§ØªØ³Ø§Ø¨</button>
     <button class="btn-del" onclick="delOrder('${d.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    </div>
   </div>
  `;
 });
}

/* ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© */
window.setStatus = async (id,status)=>{
 await updateDoc(doc(db,"orders",id),{status});
 loadOrders();
};

/* Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ */
window.delOrder = async id=>{
 if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ")){
  await deleteDoc(doc(db,"orders",id));
  loadOrders();
 }
};

/* ÙˆØ§ØªØ³Ø§Ø¨ */
window.openWA = msg=>{
 window.open("https://wa.me/?text="+msg);
};

/* ØªØ´ØºÙŠÙ„ */
loadOrders();
</script>

</body>
</html>
