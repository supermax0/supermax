<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================= RESET ================= */
*{box-sizing:border-box;margin:0;padding:0}
body{
 font-family:Tajawal,system-ui;
 background:#070b14;
 color:#fff;
 min-height:100vh;
 overflow-x:hidden;
}

/* ================= VARS ================= */
:root{
 --glass:rgba(255,255,255,.12);
 --blur:blur(28px);
 --green:#00ff88;
 --blue:#00ccff;
 --purple:#7c7cff;
 --red:#ff4d4d;
 --yellow:#ffaa00;
 --radius:28px;
}

/* ================= BG ================= */
body::before{
 content:"";
 position:fixed;
 inset:-30%;
 background:
 radial-gradient(circle at 20% 20%,#00ff8860,transparent 40%),
 radial-gradient(circle at 80% 30%,#00ccff60,transparent 40%),
 radial-gradient(circle at 50% 80%,#7c7cff50,transparent 40%);
 filter:blur(180px);
 z-index:-1;
}

/* ================= NAV ================= */
.nav{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:18px 30px;
 margin:20px;
 border-radius:24px;
 background:rgba(255,255,255,.15);
 backdrop-filter:var(--blur);
}
.nav a{
 color:#fff;
 text-decoration:none;
 font-weight:900;
 padding:10px 22px;
 border-radius:30px;
 background:rgba(255,255,255,.12);
}

/* ================= CONTAINER ================= */
.container{
 max-width:1350px;
 margin:0 auto 40px;
 padding:36px;
 border-radius:var(--radius);
 background:rgba(255,255,255,.14);
 backdrop-filter:var(--blur);
}

/* ================= STATS ================= */
.stats{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
 gap:22px;
 margin-bottom:40px;
}
.stat{
 padding:26px;
 border-radius:24px;
 background:rgba(255,255,255,.18);
 text-align:center;
}
.stat h3{
 font-size:34px;
 font-weight:900;
 color:var(--green);
}

/* ================= FORM ================= */
h2{text-align:center;margin-bottom:24px}
form{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
 gap:14px;
 margin-bottom:30px;
}
input,textarea,select{
 padding:16px;
 border:none;
 border-radius:18px;
 background:rgba(255,255,255,.18);
 color:#fff;
}
textarea{resize:none;min-height:90px}

button.save{
 grid-column:1/-1;
 padding:18px;
 border:none;
 border-radius:50px;
 background:linear-gradient(135deg,var(--green),var(--blue));
 font-weight:900;
 cursor:pointer;
 color:#000;
}

/* ================= SEARCH ================= */
.tools{
 display:flex;
 gap:12px;
 margin-bottom:20px;
 flex-wrap:wrap;
}

/* ================= LIST ================= */
.list{display:grid;gap:16px}
.item{
 display:grid;
 grid-template-columns:1fr auto;
 align-items:center;
 gap:14px;
 padding:18px;
 border-radius:22px;
 background:rgba(255,255,255,.18);
 cursor:grab;
}
.item small{opacity:.8}

/* ================= ACTIONS ================= */
.actions{display:flex;gap:10px}
.actions button{
 padding:10px 16px;
 border:none;
 border-radius:22px;
 font-weight:900;
 cursor:pointer;
}
.edit{background:linear-gradient(135deg,var(--blue),var(--purple));color:#000}
.hide{background:linear-gradient(135deg,var(--yellow),#ffcc55);color:#000}
.del{background:linear-gradient(135deg,var(--red),#ff7777);color:#fff}

/* ================= SKELETON ================= */
.skeleton{
 background:rgba(255,255,255,.15);
 border-radius:22px;
 padding:18px;
 position:relative;
 overflow:hidden;
}
.skeleton::after{
 content:"";
 position:absolute;
 inset:0;
 background:linear-gradient(120deg,transparent,rgba(255,255,255,.4),transparent);
 animation:shimmer 1.5s infinite;
}
.skeleton .line{height:14px;background:#ffffff40;border-radius:10px;margin-bottom:12px}
.skeleton .line.short{width:60%}
@keyframes shimmer{
 0%{transform:translateX(-100%)}
 100%{transform:translateX(100%)}
}

/* ================= MODAL ================= */
#preview{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.7);
 display:none;
 justify-content:center;
 align-items:center;
 z-index:9999;
}
#preview .box{
 background:#0c1320;
 padding:28px;
 border-radius:26px;
 max-width:420px;
 width:90%;
 text-align:center;
}
#preview img{
 width:100%;
 height:200px;
 object-fit:contain;
 margin:16px 0;
}
</style>
</head>

<body>

<div class="nav">
 <div>
  <a href="admin.html">ğŸ› ï¸ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
  <a href="admin-orders.html">ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
 </div>
</div>

<div class="container">

<!-- ===== STATS ===== -->
<div class="stats">
 <div class="stat"><h3 id="sProducts">0</h3><small>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</small></div>
 <div class="stat"><h3 id="sOrders">0</h3><small>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</small></div>
 <div class="stat"><h3 id="sSales">0</h3><small>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</small></div>
 <div class="stat"><h3 id="sOut">0</h3><small>Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</small></div>
</div>

<h2>ğŸ› ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>

<form id="form">
 <input placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required>
 <input type="number" placeholder="Ø§Ù„Ø­Ø¬Ù…">
 <input type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" required>
 <input type="number" placeholder="Ø§Ù„Ù…Ø®Ø²ÙˆÙ†" required>

 <select required>
  <option value="">Ø§Ù„ØªØµÙ†ÙŠÙ</option>
  <option>Ø´Ø§Ø´Ø§Øª 4K</option>
  <option>QLED</option>
  <option>Android</option>
  <option>Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©</option>
 </select>

 <textarea placeholder="Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙˆØ± (ÙƒÙ„ Ø±Ø§Ø¨Ø· Ø¨Ø³Ø·Ø±)"></textarea>
 <textarea placeholder="Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª"></textarea>

 <select>
  <option value="true">Ù†Ø´Ø·</option>
  <option value="false">Ù…Ø®ÙÙŠ</option>
 </select>

 <input type="hidden" id="editId">
 <button class="save">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
</form>

<!-- SEARCH -->
<div class="tools">
 <input id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
 <select id="filter">
  <option value="all">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
  <option>Ø´Ø§Ø´Ø§Øª 4K</option>
  <option>QLED</option>
  <option>Android</option>
  <option>Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©</option>
 </select>
</div>

<!-- LIST -->
<div class="list" id="list">
 <div class="skeleton"><div class="line"></div><div class="line short"></div></div>
 <div class="skeleton"><div class="line"></div><div class="line short"></div></div>
</div>

</div>

<!-- PREVIEW -->
<div id="preview">
 <div class="box">
  <h3 id="pvName"></h3>
  <img id="pvImg">
  <p id="pvSpecs"></p>
  <strong id="pvPrice" style="color:#00ff88"></strong><br><br>
  <button class="save" onclick="closePreview()">Ø¥ØºÙ„Ø§Ù‚</button>
 </div>
</div>

<script type="module">
import { db } from "./firebase.js";
import {
 collection, addDoc, getDocs,
 doc, updateDoc, deleteDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const list=document.getElementById("list");
const form=document.getElementById("form");
const editId=document.getElementById("editId");
let allProducts=[];

/* LOAD */
async function load(){
 const snap=await getDocs(collection(db,"products"));
 allProducts=[];
 let out=0;

 snap.forEach(d=>{
  const p={id:d.id,...d.data()};
  allProducts.push(p);
  if(p.stock<=0) out++;
 });

 allProducts.sort((a,b)=>(a.order||0)-(b.order||0));
 render(allProducts);

 document.getElementById("sProducts").textContent=allProducts.length;
 document.getElementById("sOut").textContent=out;

 const os=await getDocs(collection(db,"orders"));
 document.getElementById("sOrders").textContent=os.size;

 let sales=0;
 os.forEach(d=>sales+=Number(d.data().total||0));
 document.getElementById("sSales").textContent=sales.toLocaleString();
}

/* RENDER */
function render(arr){
 list.innerHTML="";
 if(!arr.length){list.innerHTML="Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª";return;}
 arr.forEach(p=>{
  list.innerHTML+=`
   <div class="item" draggable="true" data-id="${p.id}">
    <div onclick="preview('${p.id}')" style="cursor:pointer">
     <strong>${p.name}</strong><br>
     <small>${p.category} | Ù…Ø®Ø²ÙˆÙ†: ${p.stock}</small>
    </div>
    <div class="actions">
     <button class="edit" onclick="editProduct('${p.id}')">âœï¸</button>
     <button class="hide" onclick="toggle('${p.id}',${p.active})">
      ${p.active===false?"ğŸ‘ï¸":"ğŸš«"}
     </button>
     <button class="del" onclick="delProduct('${p.id}')">ğŸ—‘ï¸</button>
    </div>
   </div>`;
 });
}

/* SEARCH */
search.oninput=filterFn;
filter.onchange=filterFn;
function filterFn(){
 const q=search.value;
 const c=filter.value;
 render(allProducts.filter(p=>
  p.name.includes(q) &&
  (c==="all"||p.category===c)
 ));
}

/* ADD / EDIT */
form.onsubmit=async e=>{
 e.preventDefault();
 const images=form[5].value.split("\n").filter(Boolean);
 const data={
  name:form[0].value,
  size:+form[1].value,
  price:+form[2].value,
  stock:+form[3].value,
  category:form[4].value,
  images,
  specs:form[6].value,
  active:form[7].value==="true",
  updatedAt:new Date().toISOString()
 };
 if(editId.value){
  await updateDoc(doc(db,"products",editId.value),data);
 }else{
  data.order=Date.now();
  await addDoc(collection(db,"products"),data);
 }
 form.reset();editId.value="";
 load();
};

/* EDIT */
window.editProduct=id=>{
 const p=allProducts.find(x=>x.id===id);
 if(!p)return;
 form[0].value=p.name;
 form[1].value=p.size;
 form[2].value=p.price;
 form[3].value=p.stock;
 form[4].value=p.category;
 form[5].value=(p.images||[]).join("\n");
 form[6].value=p.specs;
 form[7].value=String(p.active);
 editId.value=id;
};

/* TOGGLE */
window.toggle=async(id,a)=>{
 await updateDoc(doc(db,"products",id),{active:!a});
 load();
};

/* DELETE */
window.delProduct=async id=>{
 if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")){
  await deleteDoc(doc(db,"products",id));
  load();
 }
};

/* PREVIEW */
window.preview=id=>{
 const p=allProducts.find(x=>x.id===id);
 pvName.textContent=p.name;
 pvImg.src=(p.images&&p.images[0])||"";
 pvSpecs.textContent=p.specs||"";
 pvPrice.textContent=Number(p.price).toLocaleString()+" Ø¯.Ø¹";
 preview.style.display="flex";
};
window.closePreview=()=>preview.style.display="none";

/* DRAG */
let dragSrc=null;
document.addEventListener("dragstart",e=>{
 if(e.target.classList.contains("item"))dragSrc=e.target;
});
document.addEventListener("dragover",e=>{
 if(e.target.classList.contains("item"))e.preventDefault();
});
document.addEventListener("drop",async e=>{
 if(e.target.classList.contains("item")&&dragSrc!==e.target){
  list.insertBefore(dragSrc,e.target);
  const items=[...document.querySelectorAll(".item")];
  for(let i=0;i<items.length;i++){
   await updateDoc(doc(db,"products",items[i].dataset.id),{order:i});
  }
 }
});

load();
</script>

</body>
</html>
